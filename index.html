<!DOCTYPE html>
<html>

<head>
    <title>Planner</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div id="top_header"></div>
    <div id="main_container"></div>
</body>

</html>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        // Loading state
        const state = await readState();
        state.buckets?.map(createBucket);
        state.tasks?.map(createTask);
    });

    function createElement(tag, attributes, textContent = '') {
        const element = document.createElement(tag);
        Object.entries(attributes).map(([key, value]) => {
            element.setAttribute(key, value);
        });
        element.textContent = textContent;
        return element;
    }

    function createBucket(name) {
        const bucket = createElement('div', { id: `${name}_bucket`, class: 'bucket' });
        const title = createElement('div', { class: 'title' }, name);
        const button = createElement('button', { class: 'create_task' }, '+');
        const taskContainer = createElement('div', { class: 'task_container' });
        bucket.append(title, button, taskContainer);
        document.getElementById('main_container').append(bucket);
    }

    function createTask({ title, bucket }) {
        const task = createElement('div', { class: 'task', }, title);
        const taskContainer = document.querySelector(`#${bucket}_bucket .task_container`);
        taskContainer.append(task);

    }

    async function readState() {
        const response = await fetch('http://localhost:666/readState');
        return response.json();
    }

    async function writeState(state) {
        await fetch('http://localhost:666/writeState/' + state);
    }
</script>