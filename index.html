<!DOCTYPE html>
<html>

<head>
    <title>Planner</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div id="top_header">
        <span>TOP HEADER</span>
        <input id="input" />
    </div>
    <div id="main_container"></div>
</body>

</html>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const input = document.getElementById('input');
        input.addEventListener('change', async event => {
            const value = input.value;
            await writeState(value);
        });
        input.value = await readState();

        createBucket('todo');
        createBucket('ongoing');
        createBucket('done');

        createTask('Improve style', '', [], 'todo');
        createTask('Task addition', '', [], 'todo');
        createTask('Task edition', '', [], 'todo');
        createTask('Task deletion', '', [], 'todo');
        createTask('Set up git', '', [], 'ongoing');
        createTask('Set up basic dev environment', '', [], 'done');
    });

    function createElement(tag, attributes, textContent = '') {
        const element = document.createElement(tag);
        Object.entries(attributes).map(([key, value]) => {
            element.setAttribute(key, value);
        });
        element.textContent = textContent;
        return element;
    }

    function createBucket(name) {
        const bucket = createElement('div', { id: `${name}_bucket`, class: 'bucket' });
        const title = createElement('div', { class: 'title' }, name);
        const button = createElement('button', { class: 'create_task' }, '+');
        const container = createElement('div', { class: 'task_container' });
        bucket.append(title, button, container);
        document.getElementById('main_container').append(bucket);
    }

    function createTask(title, description, _labels, bucketName) {
        const task = createElement('div', { class: 'task', }, title);
        const bucket = document.querySelector(`#${bucketName}_bucket .task_container`);
        bucket.append(task);

    }

    async function readState() {
        const response = await fetch('http://localhost:666/readState');
        return response.text();
    }

    async function writeState(state) {
        await fetch('http://localhost:666/writeState/' + state);
    }
</script>